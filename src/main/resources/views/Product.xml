<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_7.0.xsd">

  <form name="product-form" id="portal-product-form" title="Product"
    model="com.axelor.apps.base.db.Product" extension="true">
    <extend target="/">
      <attribute name="onNew" value="action-portal-group-product-onnew"/>
    </extend>
    <extend target="//field[@name='picture']">
      <attribute name="onChange"
        value="action-portal-product-record-create-thumbnail-image"/>
      <insert position="after">
        <field name="thumbnailImage" hidden="true" colSpan="12"/>
      </insert>
    </extend>
    <extend target="//panel-tabs[@name='productSpecificAttributes']/*[last()]">
      <insert position="after">
        <panel name="portalPanel" title="Portal">
          <field name="subtitle"/>
          <field name="portalDate" colSpan="3"/>
          <field name="featured" colSpan="3"/>
          <field name="homepage" colSpan="3"/>
          <field name="allowCustomNote" colSpan="3"/>
          <field name="sellOutOfStock" colSpan="3"/>
          <field name="isPrivate" colSpan="3"/>
          <field name="isEvent" colSpan="3"/>
          <field name="leftQty" readonly="true" colSpan="3"/>
          <field name="brand"/>
          <field name="portalWorkspace"/>
          <field name="portalCategorySet" widget="TagSelect"/>
          <field name="portalAvailableOptionSet" widget="TagSelect"/>
          <field name="portalAssociatedProductSet" widget="TagSelect"/>
          <field name="partnerSet" colSpan="12" showIf="isPrivate"/>
          <field name="partnerCategorySet" colSpan="12" showIf="isPrivate"/>
          <field name="longDescription" colSpan="12" widget="html"/>
          <field name="portalImageList" colSpan="12">
            <editor x-viewer="true">
              <field name="picture" showTitle="false" colSpan="12" widget="Image"/>
            </editor>
          </field>
        </panel>
      </insert>
    </extend>
  </form>

  <action-record name="action-product-set-left-qty"
    model="com.axelor.apps.base.db.Product">
    <field name="leftQty"
      expr="call:com.axelor.apps.stock.service.StockLocationService:getRealQtyOfProductInStockLocations(id, null,null)"/>
  </action-record>

  <action-group name="action-portal-group-product-onload">
    <action name="action-group-product-onload"/>
    <action name="action-product-set-left-qty"/>
  </action-group>

  <action-attrs name="action-product-attrs-set-workspace">
    <attribute name="value" for="portalWorkspace" expr="eval: __user__.workspace"/>
  </action-attrs>

  <action-attrs name="action-product-attrs-set-isEvent">
    <attribute name="value" for="isEvent"
      expr="eval: __parent__?._model == 'com.axelor.apps.portal.db.PortalEvent' || __parent__?._model == 'com.axelor.apps.portal.db.PortalEventFacility'"/>
  </action-attrs>

  <action-group name="action-portal-group-product-onnew">
    <action name="action-product-group-production-onnew"
      if="__parent__?._model == 'com.axelor.apps.production.db.BillOfMaterialImportLine'"/>
    <action name="action-product-attrs-set-workspace"/>
    <action name="action-product-attrs-set-isEvent"/>
  </action-group>

  <action-record name="action-portal-product-record-create-thumbnail-image"
    model="com.axelor.apps.base.db.Product">
    <field name="thumbnailImage"
      expr="call: com.axelor.apps.portal.utils.ImageUtils:createThumbnail(picture)"/>
  </action-record>

</object-views>